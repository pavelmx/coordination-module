<div class="d-flex justify-content-center">
  <button class="btn btn-outline-primary mb-3 " data-toggle="collapse" href="#filter">Filter</button>
</div>

<div class="collapse" id="filter">
  <div class="card card-body">
    <div class="row">
      <div class="col">
        <div class="form-group">
          <label>Employee</label>
          <select (change)="saveFilter()" class="custom-select" name="employeeId" [(ngModel)]="filter.employeeId" #employeeId="ngModel">
            <option value="">(empty)</option>
            <option *ngFor="let emp of employeeList" [ngValue]='emp.id'>
              {{emp.personalInfo.firstName}} {{emp.personalInfo.lastName}}</option>
          </select>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <label>Project</label>
          <select (change)="saveFilter()" class="custom-select" name="projectId" [(ngModel)]="filter.projectId" #projectId="ngModel">
            <option value="">(empty)</option>
            <option *ngFor="let pr of projectList" [ngValue]='pr.id'>{{pr.name}}</option>
          </select>
        </div>
      </div>
      <!-- </div>
    <div class="row"> -->
      <div class="col">
        <div class="form-group">
          <label>Reporting between dates</label>
          <div class="row">
            <div *ngIf="list" class="col">
              <input (input)="saveFilter()" min="{{list[0].reportDate}}" max="{{list[list.length-1].reportDate}}" type="date"
                class="form-control" placeholder="(empty)" name="firstDate" [(ngModel)]="filter.firstDate"
                #firstDate="ngModel">
            </div>
            <div *ngIf="list" class="col">
              <input (input)="saveFilter()" [disabled]="!filter.firstDate" type="date" class="form-control" placeholder="(empty)"
                name="lastDate" min="{{filter.firstDate}}" max="{{list[list.length-1].reportDate}}"
                [(ngModel)]="filter.lastDate" #lastDate="ngModel">
            </div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="form-group">
          <label>Choose type of report</label><br>
          <div class="btn-group" role="group" aria-label="...">
            <button class="btn btn-outline-primary mb-3 " (click)="filter.reportType=''"
              [ngClass]="{'active':filter.reportType==''}" (click)="saveFilter()">ALL</button>
            <button class="btn btn-outline-primary mb-3 " (click)="filter.reportType='WORK'"
              [ngClass]="{'active':filter.reportType=='WORK'}" (click)="saveFilter()">WORK</button>
            <button class="btn btn-outline-primary mb-3 " (click)="filter.reportType='VACATION'"
              [ngClass]="{'active':filter.reportType=='VACATION'}" (click)="saveFilter()">VACATION</button>
            <button class="btn btn-outline-primary mb-3 " (click)="filter.reportType='SICK_LEAVE'"
              [ngClass]="{'active':filter.reportType=='SICK_LEAVE'}" (click)="saveFilter()">SICK_LEAVE</button>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
          <label>Task</label>
        <input type="text" class="form-control" placeholder="(empty)" name="task" [(ngModel)]="filter.task"
          #task="ngModel" (input)="saveFilter()">
      </div>
      <div class="col">
          <label>Description task</label>
        <input type="text" class="form-control" placeholder="(empty)" name="descriptionTask"
          [(ngModel)]="filter.descriptionTask" #descriptionTask="ngModel" (input)="saveFilter()">
      </div>
      <div class="col">
          <label>Hours for task</label>
        <input type="text" class="form-control" placeholder="(empty)" name="hoursForTask"
          [(ngModel)]="filter.hoursForTask" #hoursForTask="ngModel" (input)="saveFilter()">
      </div>
    </div>
  </div>
</div>


<table class="table mt-5 table-sm ">
  <thead>
    <tr class="table-dark">
      <th scope="col">Employee</th>
      <th scope="col">Days on sick leave</th>
      <th scope="col">Days on vacation</th>
      <th scope="col">Paid hours</th>
      <th scope="col">Worked hours</th>
      <th scope="col">Working hours in month</th>
    </tr>
  </thead>
  <tbody>
    <tr class="table-dark">
      <td>{{statistics.employee}}</td>
      <td>{{statistics.daysOnSickLeave}}</td>
      <td>{{statistics.daysOnVacation}}</td>
      <td>{{statistics.paidHours}}</td>
      <td>{{statistics.workedHours}}</td>
      <td>{{statistics.workingHoursInMonth}}</td>
    </tr>
  </tbody>
</table>

<button type="button" (click)="clearAddForm()" class="btn btn-primary mt-3" data-toggle="modal" data-target="#addEdit">
  Add executed task to report
</button>

<table id="table" class="table mt-2 table-sm table-striped table-bordered">
  <thead>
    <tr>
      <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">Type
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th>
      <th scope="col" class="sortable" sortable="personalInfo.firstName" (sort)="onSort($event)">Date
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.firstName', 'caret-up':order=='asc' && column=='personalInfo.firstName'}">
        </span>
      </th>
      <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">Project name
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th>
      <!-- <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">EmployeeId
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th> -->
      <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">Task
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th>
      <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">Description task
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th>

      <th scope="col" class="sortable" sortable="personalInfo.lastName" (sort)="onSort($event)">Hours for task
        <span class="caret-blank"
          [ngClass]="{'caret-down':order=='desc' && column=='personalInfo.lastName', 'caret-up':order=='asc' && column=='personalInfo.lastName'}">
        </span>
      </th>

      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let report of list" [ngClass]="{'table-warning':report.reportType=='WORK',
    'table-success':report.reportType=='VACATION',
    'table-danger':report.reportType=='SICK_LEAVE'}">
      <td>{{report.reportType}}</td>
      <td>{{report.reportDate}}</td>
      <td *ngIf="report.project!=null">{{report.project.name}}</td>
      <td *ngIf="report.project==null">(empty)</td>
      <td *ngIf="report.task!=null">{{report.task}}</td>
      <td *ngIf="report.task==null">(empty)</td>
      <td *ngIf="report.descriptionTask!=null">{{report.descriptionTask}}</td>
      <td *ngIf="report.descriptionTask==null">(empty)</td>
      <td *ngIf="report.hoursForTask!=null">{{report.hoursForTask}}</td>
      <td *ngIf="report.hoursForTask==null">(empty)</td>
      <td style="width: 50px">
        <button type="button" (click)="getCurrentReport(report)" class="btn btn-sm btn-primary" data-toggle="modal"
          data-target="#addEdit">
          Edit
        </button>
      </td>
    </tr>
  </tbody>
</table>




<!-- Modal -->
<div class="modal fade bd-example-modal-lg" id="addEdit" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Add new node to my report</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="f.resetForm()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form #f="ngForm">

          <div class="row">
            <div class="col-3">
              <div class="form-group">
                <label>Type report</label>
                <select class="custom-select" name="reportType" [(ngModel)]="reportBody.reportType"
                  #reportType="ngModel" required [compareWith]="compareFn"
                  [ngClass]="{'is-valid':reportType.valid && reportType.touched,'is-invalid':reportType.invalid && reportType.touched}">
                  <option value="VACATION">VACATION</option>
                  <option value="WORK">WORK</option>
                  <option value="SICK_LEAVE">SICK_LEAVE</option>
                </select>
              </div>
            </div>
            <div class="col-3">
              <div class="form-group">
                <label>Date report</label>
                <input type="date" class="form-control" name="reportDate" [(ngModel)]="reportBody.reportDate"
                  #name="ngModel" required [disabled]="reportBody.reportType==null">
                <!-- [ngClass]="{'is-valid':reportDate.valid && reportDate.touched,'is-invalid':reportDate.invalid && reportDate.touched}" -->
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label>Project</label>
                <select
                  [disabled]="reportBody.reportType==null || reportBody.reportType=='SICK_LEAVE' || reportBody.reportType=='VACATION'"
                  required class="custom-select" name="project" [(ngModel)]="reportBody.project" #project="ngModel"
                  [ngClass]="{'is-valid':project.valid && project.touched,'is-invalid':project.invalid && project.touched}"
                  [compareWith]="compareFnId">
                  <option *ngFor="let project of projectList" [ngValue]="project">{{project.name}}</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label>Task</label>
                <input
                  [disabled]="reportBody.reportType==null || reportBody.reportType=='SICK_LEAVE' || reportBody.reportType=='VACATION'"
                  required type="text" class="form-control" name="task" [(ngModel)]="reportBody.task" #task="ngModel"
                  [ngClass]="{'is-valid':task.valid && task.touched,'is-invalid':task.invalid && task.touched}">
              </div>

            </div>
            <div class="col-2">
              <div class="form-group">
                <label>Hours for task</label>
                <input required type="number" min=0 class="form-control" name="hoursForTask"
                  [disabled]="reportBody.reportType==null || reportBody.reportType=='SICK_LEAVE' || reportBody.reportType=='VACATION'"
                  [(ngModel)]="reportBody.hoursForTask" #hoursForTask="ngModel"
                  [ngClass]="{'is-valid':hoursForTask.valid && hoursForTask.touched,'is-invalid':hoursForTask.invalid && hoursForTask.touched}">
              </div>
            </div>
          </div>




          <div class="form-group">
            <label>Description task</label>
            <input type="text" class="form-control" name="descriptionTask"
              [disabled]="reportBody.reportType==null || reportBody.reportType=='SICK_LEAVE' || reportBody.reportType=='VACATION'"
              [(ngModel)]="reportBody.descriptionTask" #descriptionTask="ngModel"
              [ngClass]="{'is-valid':descriptionTask.valid && descriptionTask.touched,'is-invalid':descriptionTask.invalid && descriptionTask.touched}">
          </div>


        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="f.resetForm()" data-dismiss="modal"
          (click)="initReportList()">Close</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="addEdit(f)"
          [disabled]="f.form.invalid">Save changes</button>
      </div>
    </div>
  </div>
</div>